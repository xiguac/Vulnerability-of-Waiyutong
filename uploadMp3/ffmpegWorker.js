self.onmessage = function(e) {
	switch (e.data.command) {
	case 'init':
		importScripts(e.data.ffmpeg);

		//ffmpeg初始化
		var files = [{name:'old.wav',data:new Uint8Array(4096)}];
		var arguments = ["-i", "old.wav", "-y", "-acodec", "mp2", "-ar", "16K", "-ab", "24K", "-ac", "1", "new.mp2"];
		var Module = {
			print : function(text){},
			printErr : function(text){},
			files: files,
			arguments: arguments,
			TOTAL_MEMORY: 9600000
		};
		var time = (new Date()).getTime();
		var result = ffmpeg_run(Module);
		console.log('ffmpeg初始化时间：' + ((new Date()).getTime() - time));
		console.log('ffmpegWorder.js加载完成');
		self.postMessage({command : 'initFinished'});
		break;
	case 'convert':
		//ffmpeg转码
		var files = [{name:'old.wav', data:new Uint8Array(e.data.wav)}];
		var arguments = ["-i", "old.wav", "-y", "-acodec", "mp2", "-ar", "16K", "-ab", "24K", "-ac", "1", "new.mp2"];
		var Module = {
			print : function(text){},
			printErr : function(text){},
			files: files,
			arguments: arguments,
			TOTAL_MEMORY: 32000000
		};
		var time = (new Date()).getTime();
		var result = ffmpeg_run(Module);
		self.postMessage({command : 'converted', mp2 : result[0].data, id : e.data.id});
		console.log(e.data.id + '转码完成，用时：' + ((new Date()).getTime() - time) + '毫秒');
		break;
	}
};